{% extends 'base.html' %}
{% block content %}
<a href="{% url 'catalog:catalog' %}" class="btn bg-info mt-1 mb-3">← Назад к каталогу</a>

<h3>Ваша корзина</h3>

{% if cart.cartitem_set.all %}
    <table class="table">
        <thead>
            <tr>
                <th>Товар</th>
                <th>Количество</th>
                <th>Цена</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
             {% for item in cart.cartitem_set.all %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td>
                        <form method="post" action="{% url 'orders:update_cart_item' item.id %}">
                            {% csrf_token %}
                            <input type="number" name="quantity"
                                   value="{{ item.quantity }}"
                                   min="1"
                                   max="{{ item.product.quantity }}"  <!-- Добавляем ограничение -->

                            <button type="submit" class="btn bg-info btn-outline-primary">
                                Обновить
                            </button>
                        </form>
                    </td>
                    <td>
                        {{ item.product.price }} ₽ × {{ item.quantity }}
                        {% if item.product.quantity < item.quantity %}
                            <span class="text-danger">(Доступно: {{ item.product.quantity }})</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'orders:remove_from_cart' item.id %}"
                           class="btn bg-info btn-danger">
                            Удалить
                        </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="mt-4">
        <h4 class="mb-3">Итого: {{ cart.total_price }} ₽</h4>
        <a href="{% url 'orders:checkout' %}" class="btn bg-danger">
            Оформить заказ →
        </a>
    </div>
{% else %}
    <div class="alert alert-info mt-3">Ваша корзина пуста</div>
{% endif %}
{% endblock %}